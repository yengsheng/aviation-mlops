
resources:
  containers:
  - container: mlops
    image: mcr.microsoft.com/mlops/python:latest

pr: none

trigger: none

schedules:
- cron: "25 6 * * *"
  displayName: Daily midnight build
  branches:
    include:
    - master

variables:
- group: devopsforai-aml-vg

pool:
  vmImage: ubuntu-latest

stages:
- stage: Cycle_Data
  jobs:
  - job: Cycle_Data 
    displayName: Periodic Cycling of Data
    container: mlops
    steps:
    - template: ./templates/data_cycler.yml

- stage: Retrain_Model
  jobs:
  - job: Retrain_Model 
    displayName: Retrain Model and Reregister if accuracy increases
    container: mlops
    steps:
    - template: ./templates/train_register.yml
  - job: "Training_Run_Report"
    dependsOn: "Retrain_Model"
    condition: always()
    displayName: "Publish artifact if new model was registered"
    container: mlops
    timeoutInMinutes: 0
    steps:
    - template: AviationMLOps-publish-model-artifact-template.yml
